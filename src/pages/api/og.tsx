import { ImageResponse } from '@vercel/og';
import { NextRequest } from 'next/server';

export const config = {
  runtime: 'experimental-edge',
};

const font = fetch(new URL('../../../public/assets/NeueHaasDisplayBold.ttf', import.meta.url)).then(
  (res) => res.arrayBuffer(),
);

export default async function handler(req: NextRequest) {
  try {
    const { searchParams } = new URL(req.url);
    const fontData = await font;

    const perceptionLogo = <svg width="317" height="48" viewBox="0 0 317 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clip-path="url(#clip0_1193_6413)">
        <path d="M250.647 38.3687C247.939 38.3687 245.858 37.6578 244.403 36.236C242.954 34.8418 242.105 32.9368 242.039 30.9265H244.147C244.288 32.7464 244.944 34.1344 246.114 35.0904C247.284 36.0464 248.795 36.5231 250.647 36.5204C252.475 36.5204 253.909 36.0803 254.949 35.2001C255.464 34.7627 255.872 34.2137 256.142 33.5949C256.412 32.9762 256.538 32.3039 256.509 31.6293C256.509 30.397 256.116 29.4654 255.331 28.8344C254.546 28.2033 252.956 27.594 250.562 27.0063C247.917 26.3644 245.959 25.5967 244.68 24.7192C243.4 23.8417 242.758 22.4727 242.758 20.6203C242.73 19.768 242.907 18.9214 243.274 18.1516C243.641 17.3818 244.187 16.7113 244.866 16.1964C246.272 15.0941 248.045 14.543 250.184 14.543C254.766 14.543 257.353 16.7014 257.943 21.0184H255.912C255.873 20.3671 255.699 19.7311 255.401 19.1507C255.103 18.5702 254.688 18.0581 254.181 17.6466C253.169 16.8341 251.833 16.4279 250.176 16.4279C248.456 16.4279 247.133 16.8098 246.207 17.5735C245.759 17.9302 245.4 18.3865 245.158 18.9062C244.917 19.4259 244.801 19.9947 244.818 20.5675C244.783 21.1042 244.896 21.6403 245.144 22.1173C245.393 22.5943 245.767 22.994 246.227 23.273C247.175 23.8444 248.871 24.4402 251.313 25.0604C253.816 25.6752 255.651 26.4308 256.818 27.3272C257.985 28.2237 258.572 29.6753 258.577 31.6821C258.6 32.5858 258.424 33.4836 258.062 34.3119C257.699 35.1402 257.16 35.8788 256.481 36.4757C255.064 37.7377 253.12 38.3687 250.647 38.3687Z" fill="black" />
        <path d="M277.687 37.7959H275.619V34.3185H275.534C274.807 35.4925 273.837 36.498 272.69 37.2678C271.44 38.0185 269.996 38.3858 268.539 38.324C267.616 38.3594 266.696 38.2126 265.83 37.8919C264.964 37.5713 264.17 37.0831 263.493 36.4553C262.185 35.2041 261.532 33.479 261.535 31.2799V15.0264H263.599V31.0565C263.599 32.8764 264.063 34.2305 264.992 35.1188C265.923 36.0166 267.227 36.4635 268.916 36.4635C269.813 36.4838 270.703 36.3132 271.528 35.963C272.353 35.6128 273.094 35.091 273.702 34.4323C274.337 33.7639 274.834 32.9766 275.164 32.1156C275.493 31.2546 275.65 30.3369 275.623 29.4153V15.0264H277.691L277.687 37.7959Z" fill="black" />
        <path d="M282.029 9.83066V6.30859H284.105V9.83066H282.029ZM282.029 37.796V15.0264H284.105V37.7757L282.029 37.796Z" fill="black" />
        <path d="M286.924 16.8344V15.0267H290.3V8.15723H292.367V15.0267H296.328V16.8304H292.367V33.9167C292.367 34.7291 292.526 35.3141 292.851 35.635C293.07 35.8155 293.322 35.9511 293.593 36.0341C293.864 36.117 294.149 36.1457 294.431 36.1185C295.007 36.1332 295.577 35.9929 296.08 35.7122H296.202V37.5606C295.503 37.8328 294.759 37.9706 294.009 37.9668C291.533 37.9668 290.297 36.675 290.3 34.0914V16.8263L286.924 16.8344Z" fill="black" />
        <path d="M316.199 26.9087H300.039C300.064 29.7523 300.711 32.0652 301.981 33.8472C303.251 35.6292 305.136 36.5189 307.636 36.5162C310.934 36.5162 313.101 34.7355 314.136 31.1742H316.073C315.706 33.1774 314.71 35.0115 313.23 36.4106C311.8 37.7186 309.943 38.3713 307.66 38.3686C304.605 38.3686 302.231 37.2989 300.539 35.1594C298.846 33.0198 298.001 30.1979 298.004 26.6934C298.004 23.2431 298.862 20.4414 300.579 18.2884C302.296 16.1353 304.598 15.0588 307.485 15.0588C308.518 15.0212 309.547 15.1926 310.512 15.5625C311.477 15.9325 312.357 16.4935 313.1 17.2118C315.207 19.2511 316.24 22.4834 316.199 26.9087ZM314.115 25.1822C314.058 22.7691 313.487 20.7799 312.401 19.2146C311.315 17.6492 309.671 16.8665 307.469 16.8665C305.267 16.8665 303.54 17.6289 302.286 19.1536C301.038 20.673 300.299 22.6838 300.084 25.1822H314.115Z" fill="black" />
        <path d="M46.3809 45.1973V15.2049H51.9097V18.0242H52.0316C53.6349 15.733 55.7595 14.5874 58.4055 14.5874C59.7253 14.5492 61.0349 14.8294 62.2235 15.4042C63.4121 15.9791 64.4448 16.8318 65.2343 17.8901C66.9513 20.0919 67.8098 22.9694 67.8098 26.5227C67.8098 30.1625 66.9513 33.0617 65.2343 35.2202C64.4417 36.2625 63.4121 37.1009 62.2309 37.6661C61.0498 38.2312 59.7509 38.5068 58.442 38.4701C55.6309 38.4701 53.5509 37.399 52.2022 35.2567H52.1169V45.2095L46.3809 45.1973ZM57.2192 33.4815C57.905 33.4986 58.5839 33.3418 59.1926 33.0257C59.8014 32.7096 60.3202 32.2445 60.7007 31.6737C61.5565 30.4713 61.9857 28.8138 61.9885 26.7014C61.9885 24.4373 61.5822 22.6607 60.7697 21.3716C59.9573 20.0825 58.7074 19.4365 57.0202 19.4338C55.3086 19.4338 54.0438 20.1014 53.2259 21.4366C52.4081 22.7717 52.0018 24.5321 52.0072 26.7176C52.0072 28.8003 52.4582 30.451 53.36 31.6697C54.2415 32.8721 55.5374 33.4815 57.2192 33.4815Z" fill="black" />
        <path d="M80.8005 38.4577C77.3068 38.4577 74.5634 37.3352 72.5701 35.09C70.5769 32.8449 69.5789 29.9742 69.5762 26.4778C69.5762 23.1007 70.5742 20.2746 72.5701 17.9997C73.5157 16.8958 74.6955 16.0167 76.0237 15.4264C77.3519 14.8361 78.795 14.5494 80.248 14.5873C83.6523 14.5873 86.282 15.8209 88.1371 18.2881C89.9923 20.7553 90.9212 24.058 90.9239 28.1962H75.2269C75.4544 29.9891 76.0313 31.3771 76.9575 32.3601C77.8837 33.3432 79.1498 33.8348 80.7558 33.8348C82.8628 33.8348 84.2548 32.9099 84.9319 31.0602H90.5826C90.176 33.1456 89.0396 35.0179 87.3774 36.3413C85.6631 37.7495 83.4708 38.455 80.8005 38.4577ZM80.3333 19.2143C77.5519 19.2143 75.8782 20.8284 75.3122 24.0567H84.9319C84.905 22.7596 84.4101 21.5159 83.5385 20.5549C83.13 20.1168 82.6329 19.7707 82.0802 19.5395C81.5276 19.3084 80.9321 19.1975 80.3333 19.2143Z" fill="black" />
        <path d="M98.1148 15.2051V18.8166H98.2367C98.7606 17.69 99.5229 16.6906 100.471 15.8876C101.362 15.2331 102.449 14.8995 103.554 14.9411C104.011 14.9218 104.467 14.9808 104.903 15.1158V20.3562H104.777C102.835 20.1531 101.274 20.5932 100.093 21.6765C98.9124 22.7598 98.322 24.47 98.322 26.8072V37.8162H92.5859V15.2051H98.1148Z" fill="black" />
        <path d="M116.274 38.4584C112.924 38.4584 110.237 37.3277 108.214 35.0663C106.191 32.8049 105.178 29.9613 105.176 26.5353C105.176 23.1013 106.168 20.2576 108.153 18.0044C110.139 15.7511 112.747 14.6204 115.978 14.6123C118.702 14.6123 120.923 15.3611 122.64 16.8588C124.39 18.4213 125.515 20.564 125.809 22.8914H120.194C120.034 21.9287 119.56 21.046 118.846 20.3809C118.131 19.7334 117.194 19.3871 116.229 19.414C115.476 19.3762 114.724 19.53 114.046 19.861C113.368 20.192 112.784 20.6895 112.35 21.3071C111.448 22.5691 110.997 24.3159 110.997 26.5475C110.997 28.7791 111.433 30.5192 112.305 31.7677C112.726 32.3908 113.3 32.8945 113.973 33.2298C114.646 33.5651 115.394 33.7205 116.144 33.681C118.647 33.681 120.095 32.4041 120.491 29.8502H126.016C125.884 32.2124 124.84 34.431 123.103 36.0372C121.364 37.6513 119.088 38.4584 116.274 38.4584Z" fill="black" />
        <path d="M138.445 38.4579C134.957 38.4579 132.215 37.3354 130.219 35.0902C128.223 32.8451 127.225 29.9744 127.225 26.478C127.225 23.1009 128.223 20.2748 130.219 17.9999C131.163 16.8952 132.341 16.0155 133.669 15.4251C134.997 14.8347 136.44 14.5485 137.892 14.5875C141.302 14.5875 143.932 15.8211 145.781 18.2883C147.631 20.7555 148.56 24.0582 148.568 28.1964H132.875C133.097 29.9893 133.674 31.3772 134.606 32.3603C135.538 33.3434 136.804 33.835 138.404 33.835C140.514 33.835 141.905 32.9101 142.576 31.0604H148.231C147.823 33.1463 146.686 35.0187 145.022 36.3414C143.308 37.7497 141.115 38.4552 138.445 38.4579ZM137.978 19.2145C135.194 19.2145 133.521 20.8286 132.961 24.0569H142.576C142.553 22.7598 142.059 21.5155 141.187 20.5551C140.778 20.1167 140.28 19.7704 139.727 19.5393C139.173 19.3081 138.577 19.1974 137.978 19.2145Z" fill="black" />
        <path d="M150.336 45.1973V15.2049H155.865V18.0241H155.987C157.59 15.733 159.715 14.5874 162.361 14.5874C163.681 14.5495 164.991 14.8298 166.18 15.4046C167.369 15.9794 168.403 16.8319 169.193 17.8901C170.908 20.0919 171.765 22.9694 171.765 26.5226C171.765 30.1625 170.908 33.0616 169.193 35.2201C168.4 36.2625 167.37 37.1009 166.188 37.666C165.006 38.2311 163.707 38.5067 162.397 38.47C159.586 38.47 157.506 37.3989 156.157 35.2567H156.072V45.2095L150.336 45.1973ZM161.178 33.4814C161.865 33.5015 162.546 33.3469 163.157 33.0322C163.768 32.7174 164.289 32.2528 164.672 31.6818C165.531 30.4793 165.96 28.8219 165.96 26.7095C165.96 24.4454 165.554 22.6688 164.741 21.3796C163.929 20.0905 162.676 19.4446 160.983 19.4419C159.274 19.4419 158.01 20.1095 157.189 21.4446C156.369 22.7798 155.962 24.5402 155.97 26.7257C155.97 28.8083 156.421 30.459 157.323 31.6777C158.225 32.8964 159.51 33.4977 161.178 33.4814Z" fill="black" />
        <path d="M171.984 19.1662V15.2054H174.978V8.15723H180.593V15.2054H184.301V19.1662H180.593V31.1461C180.593 32.6438 181.309 33.3926 182.742 33.3926L184.427 33.3479V37.7515C183.553 37.8138 182.358 37.8436 180.844 37.8409C179.352 37.8932 177.884 37.452 176.668 36.5856C175.539 35.7488 174.976 34.3622 174.978 32.4258V19.1662H171.984Z" fill="black" />
        <path d="M186.039 11.6831V6.30859H191.775V11.6831H186.039ZM186.039 37.796V15.2052H191.775V37.796H186.039Z" fill="black" />
        <path d="M212.986 35.0456C210.879 37.3205 208.171 38.458 204.861 38.458C201.552 38.458 198.844 37.3205 196.737 35.0456C194.627 32.7707 193.573 29.927 193.576 26.5146C193.579 23.1023 194.632 20.2586 196.737 17.9837C198.844 15.7115 201.552 14.574 204.861 14.5713C208.171 14.5686 210.879 15.706 212.986 17.9837C215.099 20.264 216.153 23.1077 216.151 26.5146C216.148 29.9216 215.093 32.7653 212.986 35.0456ZM204.861 33.8797C205.647 33.9088 206.427 33.7403 207.13 33.3897C207.834 33.0391 208.438 32.5175 208.887 31.8729C209.862 30.5377 210.348 28.7544 210.346 26.5228C210.343 24.2912 209.857 22.4997 208.887 21.1483C208.416 20.5233 207.807 20.0162 207.106 19.667C206.406 19.3178 205.634 19.136 204.851 19.136C204.069 19.136 203.297 19.3178 202.596 19.667C201.896 20.0162 201.286 20.5233 200.815 21.1483C199.857 22.4834 199.379 24.2817 199.381 26.5431C199.384 28.8045 199.862 30.5878 200.815 31.8932C201.266 32.5361 201.872 33.055 202.576 33.4022C203.28 33.7494 204.061 33.9136 204.845 33.8797H204.861Z" fill="black" />
        <path d="M223.536 15.2057V18.2769H223.662C225.151 15.8124 227.288 14.5788 230.072 14.5761C231.091 14.5421 232.104 14.7361 233.038 15.1437C233.972 15.5513 234.803 16.1624 235.471 16.9322C236.85 18.5057 237.54 20.5369 237.543 23.0258V37.7762H231.803V23.9276C231.854 22.8402 231.501 21.7724 230.812 20.9296C230.465 20.5452 230.038 20.2429 229.56 20.0447C229.082 19.8465 228.566 19.7574 228.049 19.784C227.449 19.7733 226.855 19.8985 226.31 20.1504C225.766 20.4023 225.285 20.7742 224.905 21.2383C224.048 22.2918 223.605 23.6227 223.662 24.9798V37.7965H217.926V15.2057H223.536Z" fill="black" />
        <path d="M22.6517 6.1626V0L0 11.8377V33.3682L5.59387 30.6221V15.2542L22.6517 6.1626Z" fill="#5A66AB" />
        <path d="M33.0479 17.3096V32.6776L15.9941 41.7651V47.9317L38.6459 36.094V14.5635L33.0479 17.3096Z" fill="#5A66AB" />
        <path d="M25.2729 10.0344L8.21094 19.126V46.1895L13.3661 43.1874V37.9063L30.428 28.8147V7.30859L25.2729 10.0344ZM25.7157 24.9596L13.3742 31.7437V22.5425L25.7157 15.7583V24.9596Z" fill="#5A66AB" />
      </g>
      <defs>
        <clipPath id="clip0_1193_6413">
          <rect width="316.178" height="47.9318" fill="white" />
        </clipPath>
      </defs>
    </svg>;

    return new ImageResponse(
      (
        <div
          style={{
            backgroundColor: `${searchParams.get('color')}`,
            height: '100%',
            width: '100%',
            position: 'relative',
            display: 'flex'
          }}
        >
          <div
            style={{
              position: 'absolute',
              bottom: '0px',
              backgroundColor: '#FFFFFF',
              height: '125px',
              width: '100%',
              display: 'flex',
              padding: '40px',
              justifyContent: 'space-between',
            }}>
            <span
              style={{
                alignSelf: 'center',
                fontSize: '48px',
                fontWeight: '700',
              }}>
              {searchParams.get('label')}
            </span>
            {perceptionLogo}
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
         fonts: [
        {
          name: 'Neue Haas Grotesk Display Pro 75 Bold',
          data: fontData,
          style: 'normal',
        },
      ],
      },
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}